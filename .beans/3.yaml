id: 3
title: Config + directory discovery
status: open
priority: 0
dependencies:
  - 1
created_at: 2026-01-26T15:00:00-08:00
updated_at: 2026-01-26T15:00:00-08:00
description: |
  Implement project configuration and .beans/ directory discovery.

  ## What to implement

  ### Config struct — src/config.rs
  ```rust
  pub struct Config {
      pub project: String,
      pub next_id: u32,
  }
  ```

  ### Config::load(beans_dir) -> Result<Config>
  Read .beans/config.yaml and deserialize.

  ### Config::save(&self, beans_dir) -> Result<()>
  Serialize and write to .beans/config.yaml.

  ### Config::increment_id(&mut self) -> u32
  Return current next_id and increment it. Used by bn create.

  ### find_beans_dir() -> Result<PathBuf>
  Walk up from current directory looking for .beans/ directory.
  Like git finds .git/. Returns error if not found:
  "No .beans/ directory found. Run `bn init` first."

  ## Files
  - src/config.rs (create)
  - src/discovery.rs (create — just the find_beans_dir function)

  ## Patterns
  - Config is a simple serde struct, same pattern as Bean
  - find_beans_dir: loop { check dir/.beans exists; if root, error; dir = dir.parent() }
  - Use anyhow for error handling

acceptance: |
  - Config round-trips through YAML
  - increment_id returns current value and bumps next
  - find_beans_dir finds .beans/ in current dir
  - find_beans_dir finds .beans/ in parent dir (walks up)
  - find_beans_dir returns error when no .beans/ exists
  - cargo build succeeds
  - cargo test passes
