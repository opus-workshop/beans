id: '4.2'
title: Implement hook trust mechanism (bn trust command)
status: closed
priority: 2
created_at: 2026-01-31T17:02:26.947708Z
updated_at: 2026-01-31T17:02:26.947708Z
description: |-
  Implement trust file management for hook system.

  ## What to Implement
  Extend src/hooks.rs with:

  - fn is_trusted(beans_dir: &Path) -> bool
    - Check if .beans/.hooks-trusted exists
    - Return true if exists, false otherwise

  - fn create_trust(beans_dir: &Path) -> Result<()>
    - Create .beans/.hooks-trusted file
    - Can be empty or contain timestamp + user who trusted

  - fn revoke_trust(beans_dir: &Path) -> Result<()>
    - Delete .beans/.hooks-trusted file
    - Return Err if file doesn't exist

  Create src/commands/trust.rs with:

  - pub fn cmd_trust(beans_dir: &Path, revoke: bool, check: bool) -> Result<()>
    - If check: print 'Hooks are [enabled|disabled]'
    - If revoke: call revoke_trust(), print 'Hooks disabled'
    - Otherwise: call create_trust(), print 'Hooks enabled. Review .beans/hooks before running commands'

  - Update src/cli.rs:
    - Add Trust variant to Command enum
    - Options: --revoke, --check

  - Update src/commands/mod.rs:
    - Export cmd_trust

  - Update src/main.rs:
    - Handle Command::Trust

  ## Integration Pattern
  - Hooks are disabled by default
  - execute_hook() checks is_trusted() before running any hook
  - If not trusted: silently skip hook (don't error)
  - Users explicitly run 'bn trust' to enable

  ## Testing
  - Test: bn trust creates .beans/.hooks-trusted
  - Test: bn trust --revoke removes file
  - Test: bn trust --check reports status
  - Test: execute_hook() skips when not trusted
  - Test: execute_hook() runs when trusted
acceptance: |-
  - bn trust creates .beans/.hooks-trusted file
  - bn trust --check reports 'Hooks are enabled'
  - bn trust --revoke removes trust file
  - bn trust --revoke --check reports 'Hooks are disabled'
  - is_trusted() correctly detects trust file
  - execute_hook() skips when untrusted
  - execute_hook() runs when trusted
  - Clear messages guide users
  - cargo test passes
parent: '4'
dependencies:
- '4.1'
verify: cargo test --lib hooks::is_trusted cargo test --lib trust
