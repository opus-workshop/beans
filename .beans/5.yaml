id: 5
title: bn init + bn create
status: open
priority: 1
dependencies:
  - 2
  - 3
  - 4
created_at: 2026-01-26T15:00:00-08:00
updated_at: 2026-01-26T15:00:00-08:00
description: |
  Implement the bn init and bn create commands.

  ## What to implement

  ### cmd_init(project_name: Option<String>) -> Result<()>
  - Create .beans/ directory in current directory
  - Create .beans/config.yaml with project name (auto-detect from
    directory name if not provided) and next_id: 1
  - Print: "Initialized beans in .beans/"

  ### cmd_create(args) -> Result<()>
  - Read config.yaml to get next_id
  - If --parent is given:
    - Scan existing .beans/{parent}.*.yaml files to find next child number
    - ID = "{parent}.{next_child}"
  - If no --parent:
    - ID = next_id from config
    - Increment next_id in config and save
  - Create Bean with all provided fields (title, description, acceptance,
    notes, design, priority, labels, assignee, deps)
  - Write .beans/{id}.yaml
  - Update index
  - Print: "Created bean {id}: {title}"

  ### assign_child_id(beans_dir, parent_id) -> Result<String>
  Scan .beans/ for files matching {parent_id}.*.yaml, find highest N,
  return "{parent_id}.{N+1}". If no children exist, return "{parent_id}.1".

  ### wire_to_cli
  Connect clap args to cmd_init and cmd_create. Replace the stubs
  from bean 1 with real implementations.

  ## Files
  - src/commands/init.rs (create)
  - src/commands/create.rs (create)
  - src/commands/mod.rs (create — pub mod declarations)
  - src/main.rs (modify — wire up init and create commands)

  ## Context needed
  - src/bean.rs: Bean::new(), Bean::to_file()
  - src/config.rs: Config::load(), Config::save(), Config::increment_id()
  - src/index.rs: Index::load_or_rebuild(), Index::save()
  - src/cli.rs: Clap arg structs for init and create

acceptance: |
  - `bn init` creates .beans/ with config.yaml
  - `bn init myproject` sets project name to "myproject"
  - `bn init` in a dir named "foo" auto-detects project name "foo"
  - `bn create "My first bean"` creates .beans/1.yaml
  - Second `bn create` creates .beans/2.yaml (auto-increment)
  - `bn create --parent 2 "Child bean"` creates .beans/2.1.yaml
  - `bn create --parent 2 "Another child"` creates .beans/2.2.yaml
  - Created beans have correct timestamps, default priority 2
  - Index is updated after create
  - cargo build succeeds
  - cargo test passes
