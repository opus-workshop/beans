id: 13.1.2
title: Add tests for Bean hash methods
slug: add-tests-for-bean-hash-methods
status: closed
priority: 1
created_at: 2026-02-03T07:44:18.695192Z
updated_at: 2026-02-03T07:45:32.810982Z
description: "## What to implement\n\nAdd unit tests for the Bean::hash() and Bean::from_file_with_hash() methods.\n\n### Tests to write\n\n1. **test_hash_consistency** - Same bean content produces same hash\n2. **test_hash_changes_with_content** - Different content produces different hash\n3. **test_hash_ignores_conflicts** - Conflicts field doesn't affect hash\n4. **test_from_file_with_hash** - Returns correct (bean, hash) tuple\n\n## Files\n- src/bean.rs (add tests to mod tests section, around line 500+)\n\n## Context\n\n### Existing test patterns (from src/bean.rs)\n```rust\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use tempfile::NamedTempFile;\n\n    #[test]\n    fn round_trip_minimal_bean() {\n        let bean = Bean::new(\"1\", \"My first bean\");\n        // ...\n    }\n}\n```\n\n### Tests to add\n```rust\n#[test]\nfn test_hash_consistency() {\n    let bean1 = Bean::new(\"1\", \"Test bean\");\n    let bean2 = Bean::new(\"1\", \"Test bean\");\n    assert_eq!(bean1.hash(), bean2.hash());\n}\n\n#[test]\nfn test_hash_changes_with_content() {\n    let bean1 = Bean::new(\"1\", \"Test bean\");\n    let bean2 = Bean::new(\"1\", \"Different title\");\n    assert_ne!(bean1.hash(), bean2.hash());\n}\n\n#[test]\nfn test_hash_ignores_conflicts() {\n    let mut bean1 = Bean::new(\"1\", \"Test bean\");\n    let mut bean2 = Bean::new(\"1\", \"Test bean\");\n    \n    // Add conflict to bean2\n    bean2.conflicts.push(FieldConflict {\n        field: \"title\".to_string(),\n        versions: vec![ConflictVersion {\n            value: \"\\\"old title\\\"\".to_string(),\n            agent: \"agent-1\".to_string(),\n            timestamp: Utc::now(),\n        }],\n        resolution: ConflictResolution::Pending,\n    });\n    \n    // Hashes should still match (conflicts ignored)\n    assert_eq!(bean1.hash(), bean2.hash());\n}\n\n#[test]\nfn test_from_file_with_hash() {\n    let bean = Bean::new(\"42\", \"Hash file test\");\n    let expected_hash = bean.hash();\n    \n    let tmp = NamedTempFile::new().unwrap();\n    bean.to_file(tmp.path()).unwrap();\n    \n    let (loaded, hash) = Bean::from_file_with_hash(tmp.path()).unwrap();\n    assert_eq!(loaded, bean);\n    assert_eq!(hash, expected_hash);\n}\n```\n\n## Acceptance\n- [ ] test_hash_consistency passes\n- [ ] test_hash_changes_with_content passes\n- [ ] test_hash_ignores_conflicts passes\n- [ ] test_from_file_with_hash passes\n- [ ] cargo test bean::tests passes\n\n## Produces\n- hash_tests\n\n\n## Requires\n- Bean::hash\n- Bean::from_file_with_hash\n"
closed_at: 2026-02-03T07:45:32.810982Z
close_reason: 'Added 4 unit tests for Bean hash methods: test_hash_consistency, test_hash_changes_with_content, test_hash_ignores_conflicts, and test_from_file_with_hash. Fixed test to clone beans for identical timestamps.'
parent: '13.1'
verify: cargo test bean::tests
attempts: 1
claimed_at: 2026-02-03T07:44:38.026800Z
is_archived: true
