id: '14.5'
title: Custom rendering and user commands
slug: custom-rendering-and-user-commands
status: closed
priority: 2
created_at: 2026-02-03T05:37:17.452305Z
updated_at: 2026-02-03T06:14:50.496820Z
description: "## What to implement\n\nAdd custom TUI rendering for tool calls/results and user commands.\n\n### Custom Rendering\n\nMake tool results display nicely in the TUI instead of raw JSON.\n\n**bn_status** - Render as sections:\n```\nClaimed (2)\n  11 Verify-on-claim\n  12.1 Implement worktree isolation\n\nReady (3)\n  14.1 Extension scaffold [P1]\n  15 Fix unicode bug [P2]\n```\n\n**bn_tree** - Render as tree:\n```\n14 Pi tools extension\n├── 14.1 Extension scaffold ✓\n├── 14.2 Context tools [in_progress]\n├── 14.3 Spro tools [blocked by 14.1]\n└── 14.4 Watcher tools [blocked by 14.1]\n```\n\n**spro_run** - Progress during execution, summary after\n\n### Commands\n\n1. **/beans** - Interactive bean browser (like /tools example)\n2. **/tree [id]** - Show bean tree in overlay\n\n### File\n\n~/.pi/agent/extensions/beans-tools.ts (extend existing)\n\n### Pattern for renderResult\n\n```typescript\npi.registerTool({\n  name: \"bn_status\",\n  // ...\n  renderResult(result, { expanded }, theme) {\n    const data = result.details as StatusResult;\n    let lines: string[] = [];\n    \n    lines.push(theme.fg(\"accent\", `Claimed (${data.claimed.length})`));\n    for (const bean of data.claimed) {\n      lines.push(`  ${theme.fg(\"muted\", bean.id)} ${bean.title}`);\n    }\n    // ... etc\n    \n    return new Text(lines.join(\"\\n\"), 0, 0);\n  },\n});\n```\n\n### Acceptance\n\n- bn_status renders as formatted sections\n- bn_tree renders as ASCII tree with status indicators\n- /beans command opens interactive browser\n- /tree command shows tree in overlay"
closed_at: 2026-02-03T06:14:50.496820Z
close_reason: Added custom TUI rendering for bn_status (sectioned format with priority indicators), bn_tree (unicode status symbols ✓◐○⊘), and registered /tree command that shows bean tree in overlay with scroll support and colored status indicators.
parent: '14'
verify: grep -q 'renderResult' ~/.pi/agent/extensions/beans-tools.ts && grep -q 'registerCommand' ~/.pi/agent/extensions/beans-tools.ts
claimed_at: 2026-02-03T06:13:09.025903Z
is_archived: true
produces:
- BeansCommands
- CustomRendering
requires:
- bn_status
- bn_tree
- spro_run
