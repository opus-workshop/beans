id: '16.4'
title: Structured Test Runner Tool
slug: structured-test-runner-tool
status: closed
priority: 2
created_at: 2026-02-02T09:23:51.399638Z
updated_at: 2026-02-02T09:36:57.875600Z
description: |-
  Create a pi extension that runs tests and returns structured pass/fail results.

  ## Problem
  Currently parse test output from stdout which:
  - Varies wildly between frameworks (jest, pytest, cargo test, go test)
  - Hard to extract which specific tests failed
  - Lose structured error info

  ## Solution
  Test tool that:
  - Auto-detects test framework from project files
  - Runs tests with JSON/structured output flags
  - Returns parsed results with pass/fail per test

  ## Tools
  - `test_run` - Run tests, optional filter pattern
  - `test_list` - List available tests without running
  - `test_watch` - Start test watcher (uses terminal tool)

  ## Framework Support
  - **Jest/Vitest**: --json flag
  - **Pytest**: --json-report or pytest-json-report plugin
  - **Cargo test**: --format json (nightly) or parse libtest output
  - **Go test**: -json flag
  - **Mocha**: --reporter json

  ## Result Shape
  ```typescript
  {
    summary: { total: 10, passed: 8, failed: 2, skipped: 0 },
    tests: [
      { name: 'test_foo', status: 'passed', duration: 0.5 },
      { name: 'test_bar', status: 'failed', error: 'assertion failed', file: 'src/bar.rs', line: 42 }
    ]
  }
  ```

  ## Files
  - ~/.pi/agent/extensions/test-runner/index.ts
  - ~/.pi/agent/extensions/test-runner/parsers/ (jest.ts, pytest.ts, cargo.ts, go.ts)

  ## Acceptance
  - Detects jest in a Node project and runs tests
  - Detects cargo test in a Rust project
  - Returns structured JSON with per-test results
  - Failed tests include file/line info when available
closed_at: 2026-02-02T09:36:57.875600Z
parent: '16'
verify: test -f ~/.pi/agent/extensions/test-runner/index.ts
claimed_at: 2026-02-02T09:33:40.519286Z
is_archived: true
