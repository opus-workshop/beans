id: 13.1.1
title: Add hash methods to Bean
slug: add-hash-methods-to-bean
status: closed
priority: 1
created_at: 2026-02-03T07:44:06.159742Z
updated_at: 2026-02-03T07:44:36.811160Z
description: "## What to implement\n\nAdd SHA256 hash calculation methods to Bean for optimistic locking.\n\n### Functions to write\n\n1. **Bean::hash()** - Calculate SHA256 hash of canonical bean form\n   - Clone bean, clear `conflicts` field (non-content field)\n   - Serialize to JSON (deterministic)\n   - Hash with SHA256, return hex string\n\n2. **Bean::from_file_with_hash()** - Load bean and return hash for optimistic locking\n   - Load bean via `from_file()`\n   - Calculate hash\n   - Return tuple `(bean, hash)`\n\n## Files\n- Cargo.toml (add sha2 dependency)\n- src/bean.rs (add methods to impl Bean)\n\n## Context\n\n### Add to Cargo.toml dependencies\n```toml\nsha2 = \"0.10\"\n```\n\n### Implementation (add to impl Bean block around line 260)\n```rust\n/// Calculate SHA256 hash of canonical form\npub fn hash(&self) -> String {\n    use sha2::{Sha256, Digest};\n    // Clone and clear non-content fields\n    let mut canonical = self.clone();\n    canonical.conflicts = Vec::new();  // Don't include conflicts in hash\n    \n    // Serialize to JSON (deterministic)\n    let json = serde_json::to_string(&canonical).unwrap();\n    let mut hasher = Sha256::new();\n    hasher.update(json.as_bytes());\n    format!(\"{:x}\", hasher.finalize())\n}\n\n/// Load bean with version hash for optimistic locking\npub fn from_file_with_hash(path: impl AsRef<Path>) -> Result<(Self, String)> {\n    let bean = Self::from_file(path)?;\n    let hash = bean.hash();\n    Ok((bean, hash))\n}\n```\n\n## Acceptance\n- [ ] sha2 crate added to Cargo.toml\n- [ ] Bean::hash() compiles and returns String\n- [ ] Bean::from_file_with_hash() compiles and returns Result<(Bean, String)>\n- [ ] cargo build succeeds\n\n## Produces\n- Bean::hash\n- Bean::from_file_with_hash\n"
closed_at: 2026-02-03T07:44:36.811160Z
close_reason: Added sha2 dependency and implemented Bean::hash() and Bean::from_file_with_hash() methods for optimistic locking
parent: '13.1'
verify: cargo build
claimed_at: 2026-02-03T07:44:14.564027Z
is_archived: true
