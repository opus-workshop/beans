id: '16.3'
title: Database Query Tool
slug: database-query-tool
status: closed
priority: 2
created_at: 2026-02-02T09:23:40.728405Z
updated_at: 2026-02-02T09:35:55.401447Z
description: |-
  Create a pi extension for direct database queries with structured results.

  ## Problem
  Currently need to:
  - Install CLI tools (psql, sqlite3, mysql)
  - Parse text output manually
  - Handle connection strings via bash

  ## Solution
  Native database tool with:
  - `db_connect` - Connect to database (postgres, sqlite, mysql)
  - `db_query` - Execute SQL, return structured results
  - `db_schema` - Get table schemas
  - `db_close` - Close connection

  ## Features
  - Connection pooling (reuse across calls)
  - Structured JSON results (not text tables)
  - Schema introspection
  - Transaction support (begin/commit/rollback)
  - Query timeout

  ## Reference
  - better-sqlite3: Fast SQLite for Node
  - pg: PostgreSQL client for Node
  - MCP database servers: mcpservers.org/servers/VlaadislavKr/mcp-sql-server

  ## Files
  - ~/.pi/agent/extensions/database/index.ts
  - ~/.pi/agent/extensions/database/drivers/ (postgres.ts, sqlite.ts)
  - ~/.pi/agent/extensions/database/package.json (for better-sqlite3, pg deps)

  ## Acceptance
  - Can connect to SQLite file and query
  - Can connect to PostgreSQL with connection string
  - Results come back as JSON array of objects
  - Schema command shows table structure
closed_at: 2026-02-02T09:35:55.401447Z
parent: '16'
verify: test -f ~/.pi/agent/extensions/database/index.ts
claimed_at: 2026-02-02T09:33:40.511744Z
is_archived: true
