id: '16.5'
title: Diff Tool
slug: diff-tool
status: closed
priority: 2
created_at: 2026-02-02T09:24:00.094144Z
updated_at: 2026-02-02T09:31:02.460529Z
description: |-
  Create a pi extension for generating and applying unified diffs.

  ## Problem
  Current edit tool requires exact text matching which:
  - Fails on whitespace differences
  - Can't show what changed clearly
  - No way to preview changes before applying

  ## Solution
  Diff tool that:
  - Generates unified diffs between files or strings
  - Applies patches to files
  - Shows clear before/after comparison

  ## Tools
  - `diff_generate` - Create unified diff between two files or strings
  - `diff_apply` - Apply a patch to a file (with dry-run option)
  - `diff_show` - Show diff between current file and proposed changes

  ## Features
  - Unified diff format (standard, readable)
  - Fuzzy matching for patch application (handle minor context changes)
  - Dry-run mode to preview without applying
  - Reject file generation for failed hunks
  - Color rendering in TUI

  ## Reference
  - diff library: npmjs.com/package/diff
  - patch-package: how it applies patches
  - git diff/apply internals

  ## Files
  - ~/.pi/agent/extensions/diff/index.ts
  - ~/.pi/agent/extensions/diff/package.json (for diff library)

  ## Acceptance
  - Can generate diff between two files
  - Can apply a patch to a file
  - Dry-run shows what would change without modifying
  - Handles context mismatches gracefully
closed_at: 2026-02-02T09:31:02.460529Z
parent: '16'
verify: test -f ~/.pi/agent/extensions/diff/index.ts
claimed_at: 2026-02-02T09:28:01.800411Z
is_archived: true
