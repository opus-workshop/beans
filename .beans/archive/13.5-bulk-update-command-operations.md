---
id: 13.5
title: Update all command file operations for {id}-{slug}.md naming
status: closed
priority: 1
created_at: 2026-01-30T00:00:00Z
updated_at: 2026-01-30T16:00:00Z
closed_at: 2026-01-30T16:00:00Z
parent: 13
dependencies: [13.1, 13.2, 13.3, 13.4]
type: task
---

# Update all command file operations for {id}-{slug}.md naming

## What

Update all command handlers to use the new `find_bean_file()` function instead of hardcoding file paths. This ensures all operations (show, list, update, delete, close, reopen, etc.) work with the new `{id}-{slug}.md` naming convention.

## Commands to update

Commands that interact with bean files:

1. **show.rs** — Load and display a bean
2. **list.rs** — List all beans
3. **update.rs** — Modify a bean
4. **delete.rs** — Remove a bean
5. **close.rs** — Mark bean as closed
6. **reopen.rs** — Mark bean as open
7. **sync.rs** — Sync beans with git/index
8. **index.rs** — Rebuild index (may need path updates)

## Implementation pattern

**Before:**
```rust
let path = beans_dir.join(format!("{}.yaml", id));
let bean = Bean::load(&path)?;
```

**After:**
```rust
use crate::discovery::find_bean_file;

let path = find_bean_file(&beans_dir, &id)?;
let bean = Bean::load(&path)?;
```

## Code locations

Update file operations in:
- `src/commands/show.rs` — Load bean by ID
- `src/commands/list.rs` — Enumerate bean files (glob patterns)
- `src/commands/update.rs` — Load and save bean
- `src/commands/delete.rs` — Remove bean file
- `src/commands/close.rs` — Load, modify, save
- `src/commands/reopen.rs` — Load, modify, save
- `src/commands/sync.rs` — File operations with index
- `src/index.rs` — Rebuild index with new file discovery

## Key considerations

1. **List/glob operations:** When listing all beans, glob for `.beans/*.md` instead of `.beans/*.yaml`
2. **Write operations:** When saving, use the discovered path (preserves slug)
3. **Rename/move:** If bean changes, don't rename file (slug is immutable)
4. **Index rebuild:** Scan for `.md` files and extract ID from filename

## Acceptance

- [ ] `bn show <id>` finds and displays bean
- [ ] `bn list` shows all beans (with new naming)
- [ ] `bn update <id>` loads and saves bean
- [ ] `bn delete <id>` removes bean file
- [ ] `bn close <id>` works with new naming
- [ ] `bn reopen <id>` works with new naming
- [ ] `bn sync` rebuilds index correctly
- [ ] Index contains correct paths (with slugs)
- [ ] All commands work with hierarchical IDs (11, 11.1, 11.2)
- [ ] No orphaned .yaml files remain in .beans/
- [ ] `cargo test commands::` passes
- [ ] Integration: `bn create`, `bn show`, `bn update`, `bn delete` all work end-to-end

## Testing

```bash
# Create beans (exercises create.rs)
bn create --title="Test one"          # Creates 11-test-one.md
bn create --parent=11 --title="Sub"   # Creates 11.1-sub.md

# Show bean (exercises show.rs)
bn show 11                            # Displays correctly
bn show 11.1                          # Displays correctly

# List beans (exercises list.rs)
bn list                               # Shows all with slugs

# Update bean (exercises update.rs)
bn update 11 --title="Updated"        # Changes title, preserves slug

# Close bean (exercises close.rs)
bn close 11                           # Marks as closed

# Reopen bean (exercises reopen.rs)
bn reopen 11                          # Marks as open again

# Delete bean (exercises delete.rs)
bn delete 11.1                        # Removes file

# Rebuild index (exercises sync.rs, index.rs)
bn sync                               # Index updated with new structure
```

Verify:
- All file paths use discovered names (not hardcoded)
- Glob patterns search for `.md` files
- Index tracks new naming
- No errors when finding beans with new naming
- Help text still accurate
