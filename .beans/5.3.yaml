id: '5.3'
title: Integrate selectors into all bean ID arguments across CLI
status: open
priority: 2
created_at: 2026-01-31T17:03:08.747769Z
updated_at: 2026-01-31T17:03:08.747769Z
description: "Wire selector resolution into all commands that accept bean IDs.\n\n## What to Modify\nFor each command below, add selector resolution in the match handler before calling the command:\n\nIn src/main.rs, for each command:\n1. Load index: Index::load(beans_dir)?\n2. Create SelectionContext with current_bean_id and current_user\n3. For each bean ID argument:\n   - If starts with @: parse and resolve selector\n   - Otherwise: use as-is (literal ID)\n4. Expand resolved IDs to list for bulk operations\n\nCommands to update (11 total):\n- cmd_show: single ID → resolve 1 ID\n- cmd_close: list of IDs → resolve each ID (can expand @blocked to multiple)\n- cmd_update: single ID → resolve 1 ID\n- cmd_verify: single ID → resolve 1 ID\n- cmd_claim: single ID → resolve 1 ID\n- cmd_release: single ID → resolve 1 ID\n- cmd_reopen: single ID → resolve 1 ID\n- cmd_delete: single ID → resolve 1 ID\n- cmd_dep_add: 2 IDs (id, depends_on) → resolve both\n- cmd_dep_remove: 2 IDs → resolve both\n- cmd_dep_list: single ID → resolve 1 ID\n\n## Integration Pattern\nIn main.rs match statement:\n```rust\nCommand::Show { id, ... } => {\n    validate_id(&id)?;  // Keep existing validation for literal IDs\n    let beans_dir = beans_dir_result.as_ref().unwrap();\n    let index = Index::load(beans_dir)?;\n    let context = SelectionContext { ... };\n    \n    let resolved_id = if id.starts_with('@') {\n        resolve_selector(&id, &context)?\n    } else {\n        id.clone()\n    };\n    \n    cmd_show(&resolved_id, json, short, beans_dir)?;\n}\n```\n\nFor cmd_close with multiple IDs:\n```rust\nlet resolved_ids: Vec<String> = ids.iter()\n    .flat_map(|id| {\n        if id.starts_with('@') {\n            resolve_selector(id, &context).unwrap_or_default()\n        } else {\n            vec\\![id.clone()]\n        }\n    })\n    .collect();\n```\n\n## Files\n- src/main.rs (major: update all 11 command handlers)\n- src/selector.rs (add public resolve_selector function that wraps resolution)\n\n## Testing\n- Integration test: bn show @latest works\n- Integration test: bn close @blocked closes all blocked beans\n- Integration test: bn update @me --priority=0 updates all my beans\n- Integration test: bn dep add @latest --depends-on @blocked works\n- Error test: bn show @nonexistent returns error\n- Unit tests already cover selector logic in 5.1, 5.2"
acceptance: |-
  - All 11 commands support selector syntax (@latest, @blocked, etc.)
  - Literal IDs still work (backward compatible)
  - @latest expands to single bean
  - @blocked expands to all blocked beans
  - @parent resolves from current context
  - @me filters to current user's beans
  - Errors show helpful messages
  - Integration with all commands works correctly
  - Backward compatibility maintained
  - cargo test passes
  - cargo build succeeds
parent: '5'
dependencies:
- '5.2'
verify: cargo build && cargo test
