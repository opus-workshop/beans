---
id: 12.1
title: Implement `bn archive` and `bn unarchive` commands
status: open
priority: 2
created_at: 2026-01-30T00:00:00Z
updated_at: 2026-01-30T00:00:00Z
parent: 12
type: task
---

# Implement `bn archive` and `bn unarchive` commands

## What

Two new subcommands for moving beans in/out of archive:

```bash
bn archive 100          # Move to .beans/archive/2026/01/100-old-feature.md
bn unarchive 100        # Move back to .beans/100-old-feature.md
```

## Implementation

### `bn archive <bean-id>`

1. Load bean from `.beans/<bean-id>-*.md` (find by id prefix)
2. Create archive path: `.beans/archive/<year>/<month>/`
3. Move file to archive, preserving slug
4. Update `src/bean.rs` to mark `is_archived: true` in metadata
5. Update `.beans/index.yaml` to reflect move
6. Commit: `git add .beans/; git commit -m "[archive] <id>-<slug>"`

### `bn unarchive <bean-id>`

1. Find bean in `.beans/archive/**/<bean-id>-*.md`
2. Move back to `.beans/<bean-id>-*.md`
3. Mark `is_archived: false`
4. Update index
5. Commit: `git add .beans/; git commit -m "[unarchive] <id>-<slug>"`

## Code locations

- `src/commands/archive.rs` — New file, archive logic
- `src/commands/unarchive.rs` — New file, unarchive logic
- `src/commands/mod.rs` — Register new commands
- `src/cli.rs` — Add `archive` and `unarchive` subcommands to clap
- `src/bean.rs` — Add optional `is_archived: bool` field to metadata

## Acceptance

- [ ] `bn archive <id>` moves file to `.beans/archive/YYYY/MM/<id>-<slug>.md`
- [ ] Archive directory created if needed
- [ ] File moved (not copied)
- [ ] `is_archived: true` in YAML frontmatter
- [ ] Index updated
- [ ] Git commit created with proper message
- [ ] `bn unarchive <id>` reverses the operation
- [ ] Proper error handling (bean not found, already archived, etc.)
- [ ] Tests pass

## Testing

```bash
bn create --title="Test archive"       # Creates bean 17
bn archive 17
ls .beans/archive/2026/01/17-*.md      # File exists
bn show 17                             # Still works (searches archive)
bn unarchive 17
ls .beans/17-*.md                      # Back in root
```
