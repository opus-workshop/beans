id: '5.2'
title: Implement @parent and @me selector resolution
status: open
priority: 2
created_at: 2026-01-31T17:02:58.546551Z
updated_at: 2026-01-31T17:02:58.546551Z
description: |-
  Implement remaining selector types: @parent and @me.

  ## What to Implement
  Extend src/selector.rs with:

  - fn resolve_parent(context: &SelectionContext) -> Result<String>
    - Requires: current_bean_id in context
    - Find bean in index by ID
    - Get its parent field
    - If no parent: Err('Bean X has no parent')
    - If parent not found in index: Err('Parent Y not found')
    - Return parent ID

  - fn resolve_me(context: &SelectionContext) -> Result<Vec<String>>
    - Requires: current_user in context
    - If no user: Err('BN_USER environment variable not set')
    - Filter index for beans where assignee == current_user
    - Filter for status != closed
    - Return list of IDs
    - Return empty vec if no beans for user (not an error)

  - fn resolve_selector_full(selector_type: SelectorType, context: &SelectionContext) -> Result<Vec<String>>
    - Match on SelectorType
    - Call appropriate resolve function
    - Convert single-ID results to Vec<String>
    - Consistent return type for CLI integration

  ## Files
  - src/selector.rs (extend from 5.1)

  ## Error Handling
  - @parent with no parent: clear error message
  - @parent with missing parent: error message
  - @me with no user set: helpful error with hint
  - @me with no matching beans: empty vec (OK)

  ## Testing
  - Test: resolve_parent finds correct parent
  - Test: resolve_parent errors when no parent
  - Test: resolve_parent errors when parent missing
  - Test: resolve_me filters by assignee
  - Test: resolve_me filters out closed beans
  - Test: resolve_me errors when BN_USER not set
  - Test: resolve_me returns empty vec if no matches
acceptance: |-
  - resolve_parent() finds bean's parent
  - Errors when bean has no parent
  - Errors when parent not found in index
  - resolve_me() filters by current_user
  - Filters out closed beans
  - Errors when BN_USER not set
  - Returns empty vec if no matching beans
  - resolve_selector_full() handles all types
  - Consistent Vec<String> return type
  - cargo test passes
parent: '5'
dependencies:
- '5.1'
verify: cargo test --lib selector
